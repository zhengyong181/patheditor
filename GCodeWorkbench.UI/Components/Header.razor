@namespace GCodeWorkbench.UI.Components

<header class="shrink-0 flex items-center justify-between whitespace-nowrap border-b border-solid border-border-dark px-6 py-3 bg-[#122118] transition-colors duration-200">
    <div class="flex items-center gap-4 text-white">
        <div class="size-8 rounded-full bg-primary/20 flex items-center justify-center text-primary">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M2 12h6"/>
                <path d="M22 12h-6"/>
                <path d="M12 2v6"/>
                <path d="M12 22v-6"/>
                <circle cx="12" cy="12" r="4"/>
            </svg>
        </div>
        <h2 class="text-lg font-bold leading-tight tracking-[-0.015em]">G-Code Workbench</h2>
    </div>
    
    <div class="flex flex-1 justify-center px-8">
        <div class="flex items-center gap-1 sm:gap-6 bg-surface-dark/50 px-6 py-2 rounded-full border border-border-dark shadow-sm">
            <div class="relative">
                <a class="text-white hover:text-primary transition-colors text-sm font-medium leading-normal flex items-center gap-2 cursor-pointer" 
                   @onclick="ToggleFileMenu"
                   @onclick:stopPropagation="true">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z"/>
                    </svg>
                    File
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="@(_showFileMenu ? "rotate-180" : "")"><path d="m6 9 6 6 6-6"/></svg>
                </a>
                
                @if (_showFileMenu)
                {
                    <div class="absolute top-full left-0 mt-2 bg-surface-dark border border-border-dark rounded-lg shadow-xl py-1 min-w-[180px] z-50">
                        <button class="w-full px-3 py-2 text-left text-sm text-white hover:bg-white/10 flex items-center gap-2" @onclick="HandleOpenProject">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M20 22H6.5A2.5 2.5 0 0 1 4 19.5V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v17"/></svg>
                            Open Project
                        </button>
                        <button class="w-full px-3 py-2 text-left text-sm text-white hover:bg-white/10 flex items-center gap-2" @onclick="HandleImportGCode">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>
                            Import G-Code
                        </button>
                        <button class="w-full px-3 py-2 text-left text-sm text-white hover:bg-white/10 flex items-center gap-2" @onclick="HandleImportDxf">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="m9 8 6 4-6 4Z"/></svg>
                            Import DXF
                        </button>
                        <div class="h-px bg-border-dark my-1"></div>
                        <button class="w-full px-3 py-2 text-left text-sm text-white hover:bg-white/10 flex items-center gap-2" @onclick="HandleSaveProject">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                            Save Project
                        </button>
                        <button class="w-full px-3 py-2 text-left text-sm text-white hover:bg-white/10 flex items-center gap-2" @onclick="HandleExportGCode">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
                            Export G-Code
                        </button>
                    </div>
                }
            </div>
            <a class="text-white hover:text-primary transition-colors text-sm font-medium leading-normal flex items-center gap-2 cursor-pointer" @onclick="() => {}">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>
                    <path d="m15 5 4 4"/>
                </svg>
                Edit
            </a>
            
            <!-- Undo/Redo Buttons -->
            <div class="flex items-center gap-1 border-l border-border-dark pl-4 ml-2">
                <button class="p-1.5 rounded hover:bg-white/10 transition-colors @(CanUndo ? "text-white" : "text-text-dim/40 cursor-not-allowed")"
                        title="@(CanUndo ? "Undo" : "Nothing to undo")"
                        disabled="@(!CanUndo)"
                        @onclick="OnUndo">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 7v6h6"/>
                        <path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"/>
                    </svg>
                </button>
                <button class="p-1.5 rounded hover:bg-white/10 transition-colors @(CanRedo ? "text-white" : "text-text-dim/40 cursor-not-allowed")"
                        title="@(CanRedo ? "Redo" : "Nothing to redo")"
                        disabled="@(!CanRedo)"
                        @onclick="OnRedo">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 7v6h-6"/>
                        <path d="M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7"/>
                    </svg>
                </button>
            </div>
            
            <a class="text-white hover:text-primary transition-colors text-sm font-medium leading-normal flex items-center gap-2 cursor-pointer" @onclick="() => {}">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/>
                    <circle cx="12" cy="12" r="3"/>
                </svg>
                View
            </a>
            <a class="text-white hover:text-primary transition-colors text-sm font-medium leading-normal flex items-center gap-2 cursor-pointer" @onclick="() => {}">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect width="20" height="14" x="2" y="5" rx="2"/>
                    <line x1="2" x2="22" y1="10" y2="10"/>
                </svg>
                Machine
            </a>
        </div>
    </div>
    
    <div class="flex items-center justify-end gap-4">
        <div class="flex items-center gap-2 mr-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-text-dim">
                <circle cx="12" cy="12" r="4"/>
                <path d="M12 2v2"/>
                <path d="M12 20v2"/>
                <path d="m4.93 4.93 1.41 1.41"/>
                <path d="m17.66 17.66 1.41 1.41"/>
                <path d="M2 12h2"/>
                <path d="M20 12h2"/>
                <path d="m6.34 17.66-1.41 1.41"/>
                <path d="m19.07 4.93-1.41 1.41"/>
            </svg>
            <button class="relative inline-flex h-6 w-11 items-center rounded-full bg-surface-dark border border-border-dark transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 focus:ring-offset-background-dark"
                    @onclick="OnToggleTheme">
                <span class="sr-only">Toggle theme</span>
                <span class="@(IsDarkMode ? "translate-x-6" : "translate-x-1") inline-block h-4 w-4 transform rounded-full bg-primary transition ease-in-out duration-200"></span>
            </button>
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white">
                <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>
            </svg>
        </div>
        <div class="bg-center bg-no-repeat bg-cover rounded-full size-10 border border-border-dark bg-gradient-to-br from-primary/30 to-primary/10"></div>
    </div>
</header>

@code {
    [Parameter] public EventCallback OnToggleTheme { get; set; }
    [Parameter] public bool IsDarkMode { get; set; } = true;
    
    [Parameter] public bool CanUndo { get; set; }
    [Parameter] public bool CanRedo { get; set; }
    [Parameter] public EventCallback OnUndo { get; set; }
    [Parameter] public EventCallback OnRedo { get; set; }
    
    // File menu
    [Parameter] public EventCallback OnOpenProject { get; set; }
    [Parameter] public EventCallback OnImportGCode { get; set; }
    [Parameter] public EventCallback OnImportDxf { get; set; }
    [Parameter] public EventCallback OnSaveProject { get; set; }
    [Parameter] public EventCallback OnExportGCode { get; set; }
    
    private bool _showFileMenu;
    
    private void ToggleFileMenu()
    {
        _showFileMenu = !_showFileMenu;
    }
    
    private async Task HandleOpenProject()
    {
        _showFileMenu = false;
        await OnOpenProject.InvokeAsync();
    }
    
    private async Task HandleImportGCode()
    {
        _showFileMenu = false;
        await OnImportGCode.InvokeAsync();
    }
    
    private async Task HandleImportDxf()
    {
        _showFileMenu = false;
        await OnImportDxf.InvokeAsync();
    }
    
    private async Task HandleSaveProject()
    {
        _showFileMenu = false;
        await OnSaveProject.InvokeAsync();
    }
    
    private async Task HandleExportGCode()
    {
        _showFileMenu = false;
        await OnExportGCode.InvokeAsync();
    }
}
